<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EXLUX Admin - ì²´í—˜ì‚¬ë¡€ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; word-break: keep-all; }
        .tab-content { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .wrap-text { word-break: break-all; overflow-wrap: break-word; white-space: normal; line-height: 1.5; }
        /* ì…ë ¥ì°½ í¬ì»¤ìŠ¤ ì‹œ í…Œë‘ë¦¬ ê°•ì¡° */
        input:focus, select:focus, textarea:focus { border-color: #2563eb !important; ring: 2px #3b82f6; }
    </style>
</head>
<body class="bg-gray-100 flex h-screen overflow-hidden">

    <aside class="w-64 bg-slate-900 text-white flex-shrink-0 flex flex-col">
        <div class="p-6 font-black text-2xl border-b border-slate-700 text-center uppercase tracking-tighter italic">EXLUX Admin</div>
        <nav class="flex-1 mt-6 text-sm">
            <a onclick="showTab('dash')" id="nav-dash" class="block py-4 px-6 hover:bg-slate-800 cursor-pointer border-l-4 border-transparent transition"><i class="fas fa-chart-line w-6"></i> ëŒ€ì‹œë³´ë“œ</a>
            <a onclick="showTab('list')" id="nav-list" class="block py-4 px-6 hover:bg-slate-800 cursor-pointer border-l-4 border-transparent transition"><i class="fas fa-list w-6"></i> ì²´í—˜ì‚¬ë¡€ ë¦¬ìŠ¤íŠ¸</a>
            <a onclick="initRegisterMode()" id="nav-register" class="block py-4 px-6 hover:bg-slate-800 cursor-pointer border-l-4 border-blue-400 bg-slate-800 transition"><i class="fas fa-edit w-6"></i> ì²´í—˜ì‚¬ë¡€ ë“±ë¡</a>
        </nav>
    </aside>

    <main class="flex-1 overflow-y-auto p-8">
        <div id="tab-dash" class="tab-content hidden">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">ğŸ“Š ê´€ë¦¬ í†µê³„</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white p-6 rounded-xl shadow-sm border-t-4 border-blue-500">
                    <p class="text-gray-500 text-sm font-bold">ì „ì²´ ë“±ë¡ ì‚¬ë¡€</p>
                    <p id="stat-total" class="text-3xl font-bold mt-2 text-blue-600">0ê±´</p>
                </div>
            </div>
        </div>

        <div id="tab-list" class="tab-content hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">ğŸ“ ì²´í—˜ ì‚¬ë¡€ ë¦¬ìŠ¤íŠ¸</h2>
                <button onclick="clearData()" class="text-xs text-gray-400 hover:text-red-500 underline">ì „ì²´ ë°ì´í„° ì´ˆê¸°í™”</button>
            </div>
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <table class="w-full text-sm text-left">
                    <thead class="bg-gray-50 border-b text-gray-700">
                        <tr>
                            <th class="p-4">No</th><th class="p-4">ë“±ë¡ì¼</th><th class="p-4">ì„±í•¨ (ìˆ˜ì •)</th>
                            <th class="p-4">ë‚˜ì´/ì„±ë³„</th><th class="p-4">ì§€ì—­</th><th class="p-4">ê¸°ëŠ¥</th>
                        </tr>
                    </thead>
                    <tbody id="caseTableBody">
                        </tbody>
                </table>
            </div>
        </div>

        <div id="tab-register" class="tab-content">
            <h2 class="text-2xl font-bold mb-6 text-gray-800"><i class="fas fa-pen-fancy mr-2 text-blue-600"></i> ì²´í—˜ ì‚¬ë¡€ ë“±ë¡ ë° ìˆ˜ì •</h2>
            
            <div class="max-w-4xl bg-white p-8 rounded-xl shadow-lg border border-gray-200">
                <form id="registerForm" class="space-y-8">
                    <input type="hidden" id="reg-id">
                    
                    <div>
                        <h3 class="font-bold text-lg text-blue-900 mb-4 border-b pb-2">â‘  ê¸°ë³¸ ì •ë³´ ì…ë ¥</h3>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <input type="text" id="reg-name" placeholder="ì„±í•¨" class="w-full border p-3 rounded-lg bg-white outline-none">
                            <select id="reg-year" class="w-full border p-3 rounded-lg bg-white outline-none"></select>
                            <select id="reg-month" class="w-full border p-3 rounded-lg bg-white outline-none"></select>
                            <select id="reg-day" class="w-full border p-3 rounded-lg bg-white outline-none"></select>
                            
                            <select id="reg-gender" class="w-full border p-3 rounded-lg bg-white outline-none">
                                <option value="ë‚¨">ë‚¨ì„±</option><option value="ì—¬">ì—¬ì„±</option>
                            </select>
                            <select id="reg-sido" class="w-full border p-3 rounded-lg bg-white outline-none" onchange="updateSigungu()"></select>
                            <select id="reg-sigungu" class="w-full border p-3 rounded-lg bg-white outline-none md:col-span-2"></select>
                        </div>
                    </div>

                    <div>
                        <h3 class="font-bold text-lg text-blue-900 mb-4 border-b pb-2">â‘¡ ì¦ìƒ ë° ì‚¬ìš© ì •ë³´</h3>
                        <div class="bg-gray-50 p-4 rounded-lg border mb-4">
                            <div class="flex flex-wrap gap-4 text-sm font-medium">
                                <label class="flex items-center"><input type="checkbox" name="symptom" value="í—ˆë¦¬í†µì¦" class="mr-2">í—ˆë¦¬í†µì¦</label>
                                <label class="flex items-center"><input type="checkbox" name="symptom" value="ëª©/ì–´ê¹¨" class="mr-2">ëª©/ì–´ê¹¨</label>
                                <label class="flex items-center"><input type="checkbox" name="symptom" value="ë¬´ë¦/ê´€ì ˆ" class="mr-2">ë¬´ë¦/ê´€ì ˆ</label>
                                <label class="flex items-center"><input type="checkbox" name="symptom" value="í˜ˆë‹¹/í˜ˆì••" class="mr-2">í˜ˆë‹¹/í˜ˆì••</label>
                                <label class="flex items-center"><input type="checkbox" name="symptom" value="ë¶ˆë©´/ìš°ìš¸" class="mr-2">ë¶ˆë©´/ìš°ìš¸</label>
                                <label class="flex items-center text-blue-600 font-bold"><input type="checkbox" id="etc-check" onchange="toggleEtcInput()" class="mr-2">ê¸°íƒ€</label>
                                <input type="text" id="etc-input" placeholder="ì§ì ‘ ì…ë ¥" class="hidden border-b border-blue-400 outline-none px-1 bg-transparent">
                            </div>
                        </div>
                        <select id="reg-period" class="w-full border p-3 rounded-lg mb-4 bg-white">
                            <option value="10ì¼ ì´í•˜">10ì¼ ì´í•˜ ì‚¬ìš©</option>
                            <option value="10ì¼ ì´ìƒ">10ì¼ ì´ìƒ ì‚¬ìš©</option>
                            <option value="20ì¼ ì´ìƒ">20ì¼ ì´ìƒ ì‚¬ìš©</option>
                            <option value="ê³„ì† ì‚¬ìš© ì¤‘">ê³„ì† ì‚¬ìš© ì¤‘</option>
                        </select>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <textarea id="reg-desc-symptom" placeholder="êµ¬ì²´ì  ì¦ìƒ ë‚´ìš©" class="w-full border p-4 rounded-lg h-32 resize-none focus:ring-2 focus:ring-blue-200 outline-none"></textarea>
                            <textarea id="reg-desc-change" placeholder="ì‚¬ìš© í›„ ë³€í™” (ê²°ê³¼)" class="w-full border p-4 rounded-lg h-32 resize-none focus:ring-2 focus:ring-green-200 outline-none"></textarea>
                        </div>
                    </div>

                    <div>
                        <h3 class="font-bold text-lg text-blue-900 mb-4 border-b pb-2">â‘¢ ì‚¬ì§„ ì²¨ë¶€ (ìµœëŒ€ 4ì¥)</h3>
                        <div class="flex gap-4 items-center">
                            <div id="previewGrid" class="grid grid-cols-4 gap-2 flex-grow"></div>
                            <label id="uploadLabel" class="w-24 h-24 border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center cursor-pointer hover:bg-gray-100 transition">
                                <i class="fas fa-camera text-gray-400 text-2xl"></i>
                                <span class="text-[10px] text-gray-500 mt-1 font-bold">ì‚¬ì§„ ì¶”ê°€</span>
                                <input type="file" id="fileInput" class="hidden" accept="image/*" multiple onchange="handleFiles(this.files)">
                            </label>
                        </div>
                    </div>

                    <div class="flex gap-4 pt-4">
                        <button type="button" onclick="openPosterModal()" class="flex-1 bg-slate-800 text-white py-4 rounded-xl font-bold shadow-lg hover:bg-black transition flex items-center justify-center gap-2"><i class="fas fa-eye"></i> í¬ìŠ¤í„° ë¯¸ë¦¬ë³´ê¸°</button>
                        <button type="button" onclick="saveCase()" class="flex-1 bg-blue-600 text-white py-4 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition flex items-center justify-center gap-2"><i class="fas fa-save"></i> ê°¤ëŸ¬ë¦¬ ì €ì¥í•˜ê¸°</button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <div id="posterModal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closePoster()"></div>
        <div class="relative bg-white rounded-2xl max-w-md w-full overflow-hidden shadow-2xl">
            <div class="bg-blue-900 text-white p-4 flex justify-between items-center">
                <span class="font-bold">EXLUX SUCCESS STORY</span>
                <button onclick="closePoster()" class="text-2xl font-bold">&times;</button>
            </div>
            <div class="p-6 text-center">
                <div class="border-4 border-double border-blue-900 p-4 rounded-lg bg-gray-50 mb-4">
                    <h3 id="modal-name" class="text-2xl font-black text-gray-900">ê³ ê°ë‹˜</h3>
                    <p id="modal-meta" class="text-xs font-bold text-gray-500 mt-2 border-t pt-2"></p>
                </div>
                <div class="bg-yellow-50 p-3 rounded border border-yellow-100 mb-4 text-sm text-gray-700 italic" id="modal-desc-symptom"></div>
                <div id="modal-photo-grid" class="grid grid-cols-2 gap-2 h-48 mb-4"></div>
                <div class="bg-blue-600 text-white p-4 rounded-xl font-bold shadow-lg" id="modal-desc-change"></div>
            </div>
            <div class="p-4 bg-gray-100 text-center font-bold text-blue-900 border-t">"ìµìŠ¤ëŸ­ìŠ¤ë¡œ ê±´ê°•ì„ ì°¾ìœ¼ì‹  ê²ƒì„ ì¶•í•˜ë“œë¦½ë‹ˆë‹¤"</div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜ ë° ë°ì´í„° (ìµœì‹  ì§€ì—­ ë°ì´í„° í¬í•¨)
        let fileDataUrls = [];
        const regionData = {
            "ê²½ê¸°": ["ì•ˆì‚°ì‹œ", "í™”ì„±ì‹œ", "ìˆ˜ì›ì‹œ", "ì‹œí¥ì‹œ", "ë¶€ì²œì‹œ", "í‰íƒì‹œ", "ì˜¤ì‚°ì‹œ", "êµ°í¬ì‹œ", "ì˜ì™•ì‹œ"],
            "ì„œìš¸": ["ê°•ë‚¨êµ¬", "ì†¡íŒŒêµ¬", "ê°•ì„œêµ¬", "ë§ˆí¬êµ¬", "ì€í‰êµ¬", "ì„œì´ˆêµ¬"],
            "ì¸ì²œ": ["ë‚¨ë™êµ¬", "ë¶€í‰êµ¬", "ì—°ìˆ˜êµ¬", "ì„œêµ¬"]
        };

        // [í•µì‹¬] í˜ì´ì§€ ë¡œë“œ ì¦‰ì‹œ ì‹¤í–‰ ë³´ì¥ ë¡œì§
        document.addEventListener('DOMContentLoaded', () => {
            initForm();
            refreshAll();
        });

        // ì…€ë ‰íŠ¸ ë°•ìŠ¤ ë°ì´í„° ì£¼ì… (ë…„, ì›”, ì¼, ì‹œë„)
        function initForm() {
            const y = document.getElementById('reg-year');
            const m = document.getElementById('reg-month');
            const d = document.getElementById('reg-day');
            const sido = document.getElementById('reg-sido');

            if(!y || !sido) return;

            // ë…„ë„ (1940~2026)
            y.innerHTML = '<option value="">ë…„ë„ ì„ íƒ</option>';
            for(let i=2026; i>=1940; i--) y.add(new Option(i+'ë…„', i));

            // ì›” (1~12)
            m.innerHTML = '<option value="">ì›”</option>';
            for(let i=1; i<=12; i++) m.add(new Option(i+'ì›”', i));

            // ì¼ (1~31)
            d.innerHTML = '<option value="">ì¼</option>';
            for(let i=1; i<=31; i++) d.add(new Option(i+'ì¼', i));

            // ì‹œë„
            sido.innerHTML = '<option value="">ì‹œ/ë„ ì„ íƒ</option>';
            Object.keys(regionData).forEach(s => sido.add(new Option(s, s)));
            
            updateSigungu();
        }

        function updateSigungu() {
            const sidoVal = document.getElementById('reg-sido').value;
            const sigungu = document.getElementById('reg-sigungu');
            if(!sigungu) return;
            sigungu.innerHTML = '<option value="">ì‹œ/êµ°/êµ¬ ì„ íƒ</option>';
            if(sidoVal && regionData[sidoVal]) {
                regionData[sidoVal].forEach(s => sigungu.add(new Option(s, s)));
            }
        }

        function toggleEtcInput() {
            const check = document.getElementById('etc-check');
            const input = document.getElementById('etc-input');
            input.style.display = check.checked ? 'inline-block' : 'none';
        }

        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if(fileDataUrls.length < 4) {
                    const reader = new FileReader();
                    reader.onload = (e) => { fileDataUrls.push(e.target.result); renderPreviews(); };
                    reader.readAsDataURL(file);
                }
            });
        }

        function renderPreviews() {
            const grid = document.getElementById('previewGrid');
            grid.innerHTML = fileDataUrls.map((url, i) => `
                <div class="aspect-square border rounded-lg overflow-hidden relative shadow-sm">
                    <img src="${url}" class="w-full h-full object-cover">
                    <button type="button" onclick="fileDataUrls.splice(${i},1);renderPreviews();" class="absolute top-0 right-0 bg-red-500 text-white w-5 h-5 flex items-center justify-center text-xs">Ã—</button>
                </div>
            `).join('');
            document.getElementById('uploadLabel').style.display = fileDataUrls.length >= 4 ? 'none' : 'flex';
        }

        // ì €ì¥ ë° ë°ì´í„° ê´€ë¦¬ (LocalStorage ê¸°ë°˜)
        function saveCase() {
            const name = document.getElementById('reg-name').value;
            if(!name) return alert("ì„±í•¨ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.");

            const regId = document.getElementById('reg-id').value;
            let symptoms = Array.from(document.querySelectorAll('input[name="symptom"]:checked')).map(c => c.value);
            if(document.getElementById('etc-check').checked) symptoms.push(document.getElementById('etc-input').value);

            const data = {
                id: regId ? parseInt(regId) : Date.now(),
                date: new Date().toLocaleDateString(),
                name: name,
                age: document.getElementById('reg-year').value ? (2026 - parseInt(document.getElementById('reg-year').value) + 1) + "ì„¸" : "ë¯¸ì…ë ¥",
                gender: document.getElementById('reg-gender').value,
                region: document.getElementById('reg-sido').value + ' ' + document.getElementById('reg-sigungu').value,
                symptoms: symptoms.join(', '),
                descSymptom: document.getElementById('reg-desc-symptom').value,
                descChange: document.getElementById('reg-desc-change').value,
                photos: fileDataUrls
            };

            let cases = JSON.parse(localStorage.getItem('exlux_cases') || '[]');
            if(regId) {
                const idx = cases.findIndex(c => c.id == regId);
                if(idx !== -1) cases[idx] = data;
            } else {
                cases.unshift(data);
            }

            localStorage.setItem('exlux_cases', JSON.stringify(cases));
            alert("ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
            initRegisterMode();
            showTab('list');
        }

        function refreshAll() {
            const cases = JSON.parse(localStorage.getItem('exlux_cases') || '[]');
            document.getElementById('stat-total').innerText = cases.length + "ê±´";
            
            const tbody = document.getElementById('caseTableBody');
            if(tbody) {
                tbody.innerHTML = cases.map((c, i) => `
                    <tr class="border-b hover:bg-gray-50 transition">
                        <td class="p-4">${cases.length - i}</td>
                        <td class="p-4 text-gray-500">${c.date}</td>
                        <td class="p-4 font-bold text-blue-600 cursor-pointer underline" onclick="editCase(${c.id})">${c.name}</td>
                        <td class="p-4 font-semibold text-gray-700">${c.age}/${c.gender}</td>
                        <td class="p-4 text-gray-600">${c.region}</td>
                        <td class="p-4"><button onclick="deleteCase(${c.id})" class="text-red-400 hover:text-red-600"><i class="fas fa-trash"></i></button></td>
                    </tr>
                `).join('');
                if(cases.length === 0) tbody.innerHTML = '<tr><td colspan="6" class="p-10 text-center text-gray-400">ë“±ë¡ëœ ì²´í—˜ ì‚¬ë¡€ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            }
        }

        function editCase(id) {
            const c = JSON.parse(localStorage.getItem('exlux_cases') || '[]').find(x => x.id == id);
            if(!c) return;
            initRegisterMode(false);
            document.getElementById('reg-id').value = c.id;
            document.getElementById('reg-name').value = c.name;
            document.getElementById('reg-gender').value = c.gender;
            document.getElementById('reg-desc-symptom').value = c.descSymptom;
            document.getElementById('reg-desc-change').value = c.descChange;
            fileDataUrls = c.photos || [];
            renderPreviews();
            showTab('register');
        }

        function deleteCase(id) {
            if(confirm('ì´ ì‚¬ë¡€ë¥¼ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const cases = JSON.parse(localStorage.getItem('exlux_cases') || '[]').filter(c => c.id != id);
                localStorage.setItem('exlux_cases', JSON.stringify(cases));
                refreshAll();
            }
        }

        function openPosterModal() {
            const name = document.getElementById('reg-name').value;
            if(!name) return alert("ì„±í•¨ì„ ì…ë ¥í•´ì•¼ ë¯¸ë¦¬ë³´ê¸°ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
            
            // ì´ë¦„ ë§ˆìŠ¤í‚¹ (í™ê¸¸ë™ -> í™*ë™)
            const maskedName = name.length > 2 ? name[0] + "*" + name[name.length-1] : name[0] + "*";
            document.getElementById('modal-name').innerText = maskedName + " ê³ ê°ë‹˜";
            document.getElementById('modal-meta').innerText = `${document.getElementById('reg-gender').value} | ${document.getElementById('reg-sido').value} ê±°ì£¼`;
            document.getElementById('modal-desc-symptom').innerText = document.getElementById('reg-desc-symptom').value || "ì‚¬ìš© ì „ ì¦ìƒ ë¯¸ì…ë ¥";
            document.getElementById('modal-desc-change').innerText = document.getElementById('reg-desc-change').value || "ì‚¬ìš© í›„ ê²°ê³¼ ë¯¸ì…ë ¥";
            
            const grid = document.getElementById('modal-photo-grid');
            grid.innerHTML = "";
            for(let i=0; i<4; i++) {
                grid.innerHTML += `<div class="bg-gray-100 rounded-lg border overflow-hidden">
                    ${fileDataUrls[i] ? `<img src="${fileDataUrls[i]}" class="w-full h-full object-cover">` : ''}
                </div>`;
            }
            document.getElementById('posterModal').classList.remove('hidden');
        }

        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            document.getElementById('tab-'+id).classList.remove('hidden');
            refreshAll();
        }

        function closePoster() { document.getElementById('posterModal').classList.add('hidden'); }
        function clearData() { if(confirm('ëª¨ë“  ì²´í—˜ì‚¬ë¡€ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { localStorage.removeItem('exlux_cases'); refreshAll(); } }
        function initRegisterMode(move = true) {
            document.getElementById('registerForm').reset();
            document.getElementById('reg-id').value = "";
            fileDataUrls = [];
            renderPreviews();
            if(move) showTab('register');
        }
    </script>
</body>
</html>
