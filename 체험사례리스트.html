<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì²´í—˜ ì‚¬ë¡€ ë¦¬ìŠ¤íŠ¸</title>
    <style>
        :root { --primary: #2c3e50; --accent: #3498db; --success: #27ae60; --danger: #e74c3c; --bg: #f4f6f9; }
        body { font-family: 'Pretendard', sans-serif; margin: 0; padding: 20px; background-color: var(--bg); color: #333; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 15px; }
        h2 { margin: 0; color: var(--primary); }
        .top-buttons { display: flex; gap: 10px; }
        .btn { padding: 10px 18px; border-radius: 6px; text-decoration: none; font-weight: bold; font-size: 14px; cursor: pointer; border: none; color: white; transition: 0.2s; }
        .btn:hover { opacity: 0.9; }
        .btn-excel { background-color: var(--success); }
        .btn-close { background-color: #7f8c8d; }
        .btn-register { background-color: var(--accent); }
        .search-box { margin-bottom: 15px; text-align: right; }
        .search-box input { padding: 10px; width: 250px; border: 1px solid #ddd; border-radius: 6px; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; min-width: 900px; }
        th, td { padding: 14px 10px; text-align: center; border-bottom: 1px solid #eee; }
        thead tr { background-color: #f8f9fa; color: var(--primary); }
        tbody tr:hover { background-color: #f1f7ff; }
        .name-link { color: #3498db; text-decoration: underline; font-weight: bold; cursor: pointer; }
        .btn-delete { padding: 6px 12px; background: white; border: 1px solid var(--danger); color: var(--danger); border-radius: 4px; cursor: pointer; }
        .btn-delete:hover { background: var(--danger); color: white; }
        .badge { padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; background-color: #e8f8f5; color: #1abc9c; border: 1px solid #1abc9c; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>ğŸ“‹ ì²´í—˜ ì‚¬ë¡€ ë¦¬ìŠ¤íŠ¸ <span style="font-size:0.6em; color:#888; font-weight:normal;">(ì´ <span id="totalCount">0</span>ê±´)</span></h2>
        <div class="top-buttons">
            <button onclick="downloadExcel()" class="btn btn-excel">ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
            <button onclick="goToNew()" class="btn btn-register">+ ì‹ ê·œ ë“±ë¡</button>
            <button onclick="window.close()" class="btn btn-close">âœ– ë‹«ê¸°</button>
        </div>
    </div>
    <div class="search-box">
        <input type="text" id="searchInput" onkeyup="filterTable()" placeholder="ì´ë¦„ ë˜ëŠ” ì§€ì—­ ê²€ìƒ‰...">
    </div>
    <div style="overflow-x:auto; border-top:2px solid var(--primary);">
        <table>
            <thead>
                <tr>
                    <th width="5%">ë²ˆí˜¸</th><th width="10%">ë“±ë¡ì¼</th><th width="12%">ì„±í•¨(ìƒì„¸ë³´ê¸°)</th><th width="5%">ì„±ë³„</th>
                    <th width="10%">ìƒë…„ì›”ì¼</th><th width="15%">ì§€ì—­</th><th width="15%">í†µì¦/ì¦ìƒ</th>
                    <th width="10%">ì‚¬ìš©ê¸°ê°„</th><th width="8%">ìƒíƒœ</th><th width="10%">ê´€ë¦¬</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</div>

<script>
    let caseData = [];

    window.onload = function() {
        loadTableData();
    };

    function loadTableData() {
        caseData = JSON.parse(localStorage.getItem('exlux_cases') || '[]');
        renderTable(caseData);
    }

    function renderTable(data) {
        const tbody = document.getElementById('tableBody');
        document.getElementById('totalCount').innerText = data.length;
        tbody.innerHTML = '';

        if (data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="10" style="padding:40px; color:#999;">ë“±ë¡ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.<br>ìƒë‹¨ì˜ [+ ì‹ ê·œ ë“±ë¡] ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”.</td></tr>';
            return;
        }

        data.slice().reverse().forEach((item, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${data.length - index}</td>
                <td>${item.date}</td>
                <td onclick="goToEdit('${item.id}')" class="name-link">${item.name}</td>
                <td>${item.gender}</td>
                <td>${item.birth}</td>
                <td>${item.region}</td>
                <td>${item.symptom}</td>
                <td>${item.period}</td>
                <td><span class="badge">${item.note || 'ê³„ì†ì‚¬ìš©ì¤‘'}</span></td>
                <td><button class="btn-delete" onclick="deleteItem(event, '${item.id}')">ì‚­ì œ</button></td>
            `;
            tbody.appendChild(row);
        });
    }

    // [í•µì‹¬] ì‹ ê·œ ë“±ë¡ ì‹œ ê¸°ì¡´ ê¸°ì–µ ì‚­ì œ
    function goToNew() {
        localStorage.removeItem('edit_case_id'); // í¸ì§‘ ID ì‚­ì œ
        localStorage.removeItem('show_poster_immediately'); // í¬ìŠ¤í„° ì‹ í˜¸ ì‚­ì œ
        location.href = 'ì²´í—˜ì‚¬ë¡€ë“±ë¡.html'; // ì´ë™
    }

    function goToEdit(id) {
        localStorage.setItem('edit_case_id', id); 
        localStorage.setItem('show_poster_immediately', 'true'); 
        location.href = 'ì²´í—˜ì‚¬ë¡€ë“±ë¡.html';
    }

    function deleteItem(event, id) {
        event.stopPropagation();
        if (confirm("ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            caseData = caseData.filter(item => item.id != id);
            localStorage.setItem('exlux_cases', JSON.stringify(caseData));
            loadTableData();
        }
    }

    function filterTable() {
        const keyword = document.getElementById('searchInput').value.toUpperCase();
        const filtered = caseData.filter(item => 
            item.name.toUpperCase().includes(keyword) || 
            item.region.toUpperCase().includes(keyword) ||
            item.symptom.toUpperCase().includes(keyword)
        );
        renderTable(filtered);
    }

    function downloadExcel() {
        if(caseData.length===0) return alert("ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
        let csv = "\uFEFFë²ˆí˜¸,ë“±ë¡ì¼,ì„±í•¨,ì„±ë³„,ìƒë…„ì›”ì¼,ì§€ì—­,ì¦ìƒ,ì‚¬ìš©ê¸°ê°„\n";
        caseData.forEach((item, i) => {
            csv += `${i+1},${item.date},${item.name},${item.gender},${item.birth},${item.region},${item.symptom},${item.period}\n`;
        });
        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "ìµìŠ¤ëŸ­ìŠ¤_ì²´í—˜ì‚¬ë¡€.csv";
        link.click();
    }
</script>
</body>
</html>